(()=>{"use strict";var e={945:function(e,t,r){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.AmountRequired=void 0;const n=a(r(742)),s=a(r(732)),i=r(784),o=r(675);t.AmountRequired=class{constructor(e,t,r){this._currentValue=i.toBN(0),this._requiredValue=i.toBN(0),this._name=e,this._requiredValue=t,this._listener=r}get currentValue(){return this._currentValue}set currentValue(e){const t=!this._currentValue.eq(e),r=this.isSatisfied;this._currentValue=e,t&&this._onChange(r)}get requiredValue(){return this._requiredValue}set requiredValue(e){const t=!this._requiredValue.eq(e),r=this.isSatisfied;this._requiredValue=e,t&&this._onChange(r)}_onChange(e){let t;t=e===this.isSatisfied?"still"+(this.isSatisfied?"":" not"):this.isSatisfied?"now":"no longer";const r=`${this._name} requirement is ${t} satisfied\n${this.description}`;s.default.warn(r),null!=this._listener&&this._listener()}get isSatisfied(){return this._currentValue.gte(this._requiredValue)}get description(){const e=o.boolString(this.isSatisfied),t=new n.default(this._currentValue).toEth().toFixed(4),r=new n.default(this._requiredValue).toEth().toFixed(4);return`${this._name.padEnd(14)} | ${e.padEnd(14)} | actual: ${t.padStart(12)} RBTC | required: ${r.padStart(12)} RBTC`}}},738:function(e,t,r){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.constants=void 0;const n=a(r(416)),s=r(784).toBN(1e18);t.constants={dayInSec:86400,weekInSec:604800,oneEther:s,ZERO_ADDRESS:"0x0000000000000000000000000000000000000000",ZERO_BYTES32:"0x0000000000000000000000000000000000000000000000000000000000000000",MAX_UINT256:new n.default("2").pow(new n.default("256")).sub(new n.default("1")),MAX_INT256:new n.default("2").pow(new n.default("255")).sub(new n.default("1")),MIN_INT256:new n.default("2").pow(new n.default("255")).mul(new n.default("-1")),SHA3_NULL_S:"0xc5d2460186f7233c927e7db2dcc703c0e500b653ca82273b7bfad8045d85a470",TRANSACTION_CREATE_CONTRACT_GAS_COST:53e3,TRANSACTION_GAS_COST:21e3,TX_ZERO_DATA_GAS_COST:4,TX_NO_ZERO_DATA_GAS_COST:68,MAX_ESTIMATED_GAS_DEVIATION:.2,ESTIMATED_GAS_CORRECTION_FACTOR:1,INTERNAL_TRANSACTION_ESTIMATE_CORRECTION:2e4,WAIT_FOR_RECEIPT_RETRIES:6,WAIT_FOR_RECEIPT_INITIAL_BACKOFF:1e3}},359:function(e,t,r){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.getRawTxOptions=t.StakePenalized=t.StakeWithdrawn=t.StakeUnlocked=t.StakeAdded=t.TransactionRejectedByRecipient=t.TransactionRelayed=t.RelayWorkersAdded=t.RelayServerRegistered=void 0;const n=a(r(477)),s=a(r(409)),i=a(r(732)),o=r(820),l=r(675),c=r(738),u=a(r(319)),d=a(r(223)),y=r(784),h=r(414);a(r(748)).default.install({errorFormatterForce:!0}),t.RelayServerRegistered="RelayServerRegistered",t.RelayWorkersAdded="RelayWorkersAdded",t.TransactionRelayed="TransactionRelayed",t.TransactionRejectedByRecipient="TransactionRelayedButRevertedByRecipient";const f=[t.RelayServerRegistered,t.RelayWorkersAdded,t.TransactionRelayed,t.TransactionRejectedByRecipient];function p(e,t,r){return null!=r&&"main"!==r&&"private"!==r||(r="mainnet"),{common:n.default.forCustomChain(r,{chainId:e,networkId:t},"istanbul")}}t.StakeAdded="StakeAdded",t.StakeUnlocked="StakeUnlocked",t.StakeWithdrawn="StakeWithdrawn",t.StakePenalized="StakePenalized",t.default=class{constructor(e,t){this.VERSION="2.0.1",this.versionManager=new d.default(this.VERSION),this.web3=new s.default(e),this.config=t,this.provider=e,this.chainId=t.chainId,this.IRelayVerifierContract=h({contractName:"IRelayVerifier",abi:o.IRelayVerifier.abi}),this.IDeployVerifierContract=h({contractName:"IDeployVerifier",abi:o.IDeployVerifier.abi}),this.IRelayHubContract=h({contractName:"IRelayHub",abi:o.IRelayHub.abi}),this.IForwarderContract=h({contractName:"IForwarder",abi:o.IForwarder.abi}),this.IWalletFactoryContract=h({contractName:"IWalletFactory",abi:o.IWalletFactory.abi}),this.ITokenHandlerContract=h({contractName:"ITokenHandler",abi:o.ITokenHandler.abi}),this.IRelayHubContract.setProvider(this.provider,void 0),this.IRelayVerifierContract.setProvider(this.provider,void 0),this.IDeployVerifierContract.setProvider(this.provider,void 0),this.IForwarderContract.setProvider(this.provider,void 0),this.IWalletFactoryContract.setProvider(this.provider,void 0),this.ITokenHandlerContract.setProvider(this.provider,void 0)}getProvider(){return this.provider}async init(){if(i.default.debug("Contract Interactor - Initializing"),this.isInitialized())throw new Error("_init has already called");await this._initializeContracts(),i.default.debug("Contract Interactor - Initialized succesfully"),await this._validateCompatibility().catch((e=>console.log("WARNING: beta ignore version compatibility",e.message)));const e=await this.web3.eth.net.getNetworkType();this.chainId=await this.getAsyncChainId(),this.networkId=await this.web3.eth.net.getId(),this.networkType=await this.web3.eth.net.getNetworkType(),i.default.debug(`Contract Interactor - Using chainId: ${this.chainId}, netowrkId:${this.networkId} , networkType:${this.networkType} `),this.rawTxOptions=p(this.chainId,this.networkId,e)}isInitialized(){return null!=this.rawTxOptions}async getAsyncChainId(){return await this.web3.eth.getChainId()}async _validateCompatibility(){if(this.config.relayHubAddress===c.constants.ZERO_ADDRESS)return;const e=this.relayHubInstance,t=await e.versionHub();this._validateVersion(t)}_validateVersion(e){if(!this.versionManager.isMinorSameOrNewer(e))throw new Error(`Provided Hub version(${e}) is not supported by the current interactor(${this.versionManager.componentVersion})`)}async _initializeContracts(){this.config.relayHubAddress!==c.constants.ZERO_ADDRESS&&(this.relayHubInstance=await this._createRelayHub(this.config.relayHubAddress),i.default.debug(`Contract Interactor - Relay Hub initialized: ${this.relayHubInstance.address}`)),this.config.relayVerifierAddress!==c.constants.ZERO_ADDRESS&&(this.relayVerifierInstance=await this._createRelayVerifier(this.config.relayVerifierAddress),i.default.debug(`Contract Interactor - Relay Verifier initialized: ${this.relayVerifierInstance.address}`)),this.config.deployVerifierAddress!==c.constants.ZERO_ADDRESS&&(this.deployVerifierInstance=await this._createDeployVerifier(this.config.deployVerifierAddress),i.default.debug(`Contract Interactor - Deploy Verifier initialized: ${this.deployVerifierInstance.address}`)),console.log("Contracts initialized correctly")}getRawTxOptions(){if(null==this.rawTxOptions)throw new Error("_init not called");return this.rawTxOptions}async _createRelayVerifier(e){return await this.IRelayVerifierContract.at(e)}async _createDeployVerifier(e){return await this.IDeployVerifierContract.at(e)}async createTokenHandler(e){return await this.ITokenHandlerContract.at(e)}async _createRelayHub(e){return await this.IRelayHubContract.at(e)}async _createForwarder(e){return await this.IForwarderContract.at(e)}async _createFactory(e){return await this.IWalletFactoryContract.at(e)}async getSenderNonce(e){const t=await this._createForwarder(e);return(await t.nonce()).toString()}async getFactoryNonce(e,t){const r=await this._createFactory(e);return(await r.nonce(t)).toString()}async _getBlockGasLimit(){return(await this.web3.eth.getBlock("latest")).gasLimit}async validateAcceptRelayCall(e,t){const r=this.relayHubInstance,a=await this.getMaxViewableRelayGasLimit(e,t);if(0===a)return{verifierAccepted:!1,reverted:!1,returnValue:`relayWorker ${e.relayData.relayWorker} does not have enough balance to cover the maximum possible gas for this transaction`,revertedInDestination:!1};try{await this.relayVerifierInstance.contract.methods.verifyRelayedCall(e,t).call({from:e.relayData.relayWorker},"pending")}catch(e){return{verifierAccepted:!1,reverted:!1,returnValue:`view call to 'relayCall' reverted in verifier: ${e instanceof Error?e.message:JSON.stringify(e,u.default)}`,revertedInDestination:!1}}try{return{verifierAccepted:!0,reverted:!1,returnValue:"",revertedInDestination:!await r.contract.methods.relayCall(e,t).call({from:e.relayData.relayWorker,gasPrice:e.relayData.gasPrice,gas:y.toHex(a)})}}catch(e){return{verifierAccepted:!0,reverted:!0,returnValue:`view call to 'relayCall' reverted in client: ${e instanceof Error?e.message:JSON.stringify(e,u.default)}`,revertedInDestination:!1}}}async validateAcceptDeployCall(e){const t=this.relayHubInstance,r=await this.getMaxViewableDeployGasLimit(e);if(r.eq(y.toBN(0)))return{verifierAccepted:!1,reverted:!1,returnValue:`relayWorker ${e.relayRequest.relayData.relayWorker} does not have enough balance to cover the maximum possible gas for this transaction`};try{await this.deployVerifierInstance.contract.methods.verifyRelayedCall(e.relayRequest,e.metadata.signature).call({from:e.relayRequest.relayData.relayWorker})}catch(e){return{verifierAccepted:!1,reverted:!1,returnValue:`view call to 'deploy call' reverted in verifier: ${e instanceof Error?e.message:JSON.stringify(e,u.default)}`}}try{return{verifierAccepted:!0,reverted:!1,returnValue:(await t.contract.methods.deployCall(e.relayRequest,e.metadata.signature).call({from:e.relayRequest.relayData.relayWorker,gasPrice:e.relayRequest.relayData.gasPrice,gas:r})).returnValue}}catch(e){return{verifierAccepted:!0,reverted:!0,returnValue:`view call to 'deployCall' reverted in client: ${e instanceof Error?e.message:JSON.stringify(e,u.default)}`}}}async getMaxViewableDeployGasLimit(e){const t=y.toBN(e.relayRequest.relayData.gasPrice);let r=y.toBN(0);if(!t.eq(y.toBN(0))){const a=y.toBN(await this.walletFactoryEstimateGasOfDeployCall(e));y.toBN(await this.getBalance(e.relayRequest.relayData.relayWorker)).div(t).gte(a)&&(r=a)}return r}async estimateRelayTransactionMaxPossibleGas(e,t){const r=await this.estimateGas({from:e.relayData.relayWorker,to:e.request.relayHub,data:this.relayHubInstance.contract.methods.relayCall(e,t).encodeABI(),gasPrice:e.relayData.gasPrice});return Math.ceil(r*c.constants.ESTIMATED_GAS_CORRECTION_FACTOR)}async estimateRelayTransactionMaxPossibleGasWithTransactionRequest(e){if(void 0===e.metadata.relayHubAddress||null===e.metadata.relayHubAddress||e.metadata.relayHubAddress===c.constants.ZERO_ADDRESS)throw new Error("calculateDeployCallGas: RelayHub must be defined");const t=(await this._createRelayHub(e.metadata.relayHubAddress)).contract.methods.relayCall(e.relayRequest,e.metadata.signature),r=await t.estimateGas({from:e.relayRequest.relayData.relayWorker,gasPrice:e.relayRequest.relayData.gasPrice});return Math.ceil(r*c.constants.ESTIMATED_GAS_CORRECTION_FACTOR)}async estimateDestinationContractCallGas(e,t=!0){const r=await this.estimateGas({from:e.from,to:e.to,gasPrice:e.gasPrice,data:e.data});let a=r>c.constants.INTERNAL_TRANSACTION_ESTIMATE_CORRECTION?r-c.constants.INTERNAL_TRANSACTION_ESTIMATE_CORRECTION:r;return t&&(a*=c.constants.ESTIMATED_GAS_CORRECTION_FACTOR),a}async getMaxViewableRelayGasLimit(e,t){const r=y.toBN(e.relayData.gasPrice);let a=0;if(r.gt(y.toBN(0))){const n=await this.estimateRelayTransactionMaxPossibleGas(e,t);y.toBN(await this.getBalance(e.relayData.relayWorker)).div(r).gte(y.toBN(n))&&(a=n)}return a}encodeRelayCallABI(e,t){return new this.IRelayHubContract("").contract.methods.relayCall(e,t).encodeABI()}encodeDeployCallABI(e,t){return new this.IRelayHubContract("").contract.methods.deployCall(e,t).encodeABI()}async getPastEventsForHub(e,t,r=f){return await this._getPastEvents(this.relayHubInstance.contract,r,e,t)}async getPastEventsForStakeManagement(e,t,r){const a=this.relayHubInstance;return await this._getPastEvents(a.contract,e,t,r)}async _getPastEvents(e,t,r,a){const n=[],s=l.event2topic(e,t);return n.push(s),r.length>0&&n.push(r),e.getPastEvents("allEvents",Object.assign({},a,{topics:n}))}async getBalance(e,t="latest"){return await this.web3.eth.getBalance(e,t)}async getBlockNumber(){return await this.web3.eth.getBlockNumber()}async sendSignedTransaction(e){return await this.web3.eth.sendSignedTransaction(e)}async estimateGas(e){return await this.web3.eth.estimateGas(e)}async getGasPrice(){return await this.web3.eth.getGasPrice()}async getTransactionCount(e,t){return await this.web3.eth.getTransactionCount(e,t)}async getTransaction(e){return await this.web3.eth.getTransaction(e)}async getBlock(e){return await this.web3.eth.getBlock(e)}validateAddress(e,t="invalid address:"){if(!this.web3.utils.isAddress(e))throw new Error(t+" "+e)}async getCode(e){return await this.web3.eth.getCode(e)}getChainId(){if(null==this.chainId)throw new Error("_init not called");return this.chainId}getNetworkId(){if(null==this.networkId)throw new Error("_init not called");return this.networkId}getNetworkType(){if(null==this.networkType)throw new Error("_init not called");return this.networkType}async isContractDeployed(e){const t=await this.web3.eth.getCode(e);return"0x"!==t&&"0x00"!==t}async getStakeInfo(e){return await this.relayHubInstance.getStakeInfo(e)}async walletFactoryDeployEstimateGasForInternalCall(e,t,r,a,n,s=!1){const i=(await this._createFactory(t)).contract.methods.relayedUserSmartWalletCreation(e.request,r,a,n);return s&&await i.call({from:e.request.relayHub}),i.estimateGas({from:e.request.relayHub,gasPrice:e.relayData.gasPrice})}async walletFactoryEstimateGasOfDeployCall(e){if(void 0===e.metadata.relayHubAddress||null===e.metadata.relayHubAddress||e.metadata.relayHubAddress===c.constants.ZERO_ADDRESS)throw new Error("calculateDeployCallGas: RelayHub must be defined");return(await this._createRelayHub(e.metadata.relayHubAddress)).contract.methods.deployCall(e.relayRequest,e.metadata.signature).estimateGas({from:e.relayRequest.relayData.relayWorker,gasPrice:e.relayRequest.relayData.gasPrice})}async getRegisterRelayMethod(e){return this.relayHubInstance.contract.methods.registerRelayServer(e)}async getAddRelayWorkersMethod(e){return this.relayHubInstance.contract.methods.addRelayWorkers(e)}async broadcastTransaction(e){return await new Promise(((t,r)=>{if(null==this.provider)throw new Error("provider is not set");this.provider.send({jsonrpc:"2.0",method:"eth_sendRawTransaction",params:[e],id:Date.now()},((e,a)=>{null!=e?r(e):null!=a.error?r(a.error):t(a.result)}))}))}async getTransactionReceipt(e,t=c.constants.WAIT_FOR_RECEIPT_RETRIES,r=c.constants.WAIT_FOR_RECEIPT_INITIAL_BACKOFF){for(let a=0,n=r;a<t;a++,n*=2){const t=await this.web3.eth.getTransactionReceipt(e);if(t)return t;await l.sleep(n)}throw new Error(`No receipt found for this transaction ${e}`)}},t.getRawTxOptions=p},874:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},422:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.cloneDeployRequest=t.cloneRelayRequest=void 0,t.cloneRelayRequest=function(e){return{request:Object.assign({},e.request),relayData:Object.assign({},e.relayData)}},t.cloneDeployRequest=function(e){return{request:Object.assign({},e.request),relayData:Object.assign({},e.relayData)}}},172:function(e,t,r){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.RequestType=t.DEPLOY_PARAMS=t.ENVELOPING_PARAMS=t.TypedDeployRequestData=t.getDomainSeparatorHash=t.getDomainSeparator=t.DomainSeparatorType=t.DeployRequestDataType=t.ForwardRequestType=t.EIP712DomainType=void 0;const n=r(458),s=r(519);a(r(748)).default.install({errorFormatterForce:!0}),t.EIP712DomainType=[{name:"name",type:"string"},{name:"version",type:"string"},{name:"chainId",type:"uint256"},{name:"verifyingContract",type:"address"}];const i=[{name:"gasPrice",type:"uint256"},{name:"domainSeparator",type:"bytes32"},{name:"relayWorker",type:"address"},{name:"callForwarder",type:"address"},{name:"callVerifier",type:"address"}];t.ForwardRequestType=[{name:"relayHub",type:"address"},{name:"from",type:"address"},{name:"to",type:"address"},{name:"tokenContract",type:"address"},{name:"value",type:"uint256"},{name:"gas",type:"uint256"},{name:"nonce",type:"uint256"},{name:"tokenAmount",type:"uint256"},{name:"tokenGas",type:"uint256"},{name:"data",type:"bytes"}],t.DeployRequestDataType=[{name:"relayHub",type:"address"},{name:"from",type:"address"},{name:"to",type:"address"},{name:"tokenContract",type:"address"},{name:"recoverer",type:"address"},{name:"value",type:"uint256"},{name:"nonce",type:"uint256"},{name:"tokenAmount",type:"uint256"},{name:"tokenGas",type:"uint256"},{name:"index",type:"uint256"},{name:"data",type:"bytes"}];const o=[...t.ForwardRequestType,{name:"relayData",type:"RelayData"}],l=[...t.DeployRequestDataType,{name:"relayData",type:"RelayData"}];function c(e,r){return{name:t.DomainSeparatorType.name,version:t.DomainSeparatorType.version,chainId:r,verifyingContract:e}}t.DomainSeparatorType={prefix:"string name,string version",name:"RSK Enveloping Transaction",version:"2"},t.getDomainSeparator=c,t.getDomainSeparatorHash=function(e,r){return s.bufferToHex(n.TypedDataUtils.hashStruct("EIP712Domain",c(e,r),{EIP712Domain:t.EIP712DomainType}))},t.default=class{constructor(e,r,a){this.types={EIP712Domain:t.EIP712DomainType,RelayRequest:o,RelayData:i},this.domain=c(r,e),this.primaryType="RelayRequest",this.message=Object.assign(Object.assign({},a.request),{relayData:a.relayData})}},t.TypedDeployRequestData=class{constructor(e,r,a){this.types={EIP712Domain:t.EIP712DomainType,RelayRequest:l,RelayData:i},this.domain=c(r,e),this.primaryType="RelayRequest",this.message=Object.assign(Object.assign({},a.request),{relayData:a.relayData})}},t.ENVELOPING_PARAMS="address relayHub,address from,address to,address tokenContract,uint256 value,uint256 gas,uint256 nonce,uint256 tokenAmount,uint256 tokenGas,bytes data",t.DEPLOY_PARAMS="address relayHub,address from,address to,address tokenContract,address recoverer,uint256 value,uint256 nonce,uint256 tokenAmount,uint256 tokenGas,uint256 index,bytes data",t.RequestType={typeName:"RelayRequest",typeSuffix:"RelayData relayData)RelayData(uint256 gasPrice,bytes32 domainSeparator,address relayWorker,address callForwarder,address callVerifier)"}},917:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isRsk=t.getEnvironment=t.defaultEnvironment=t.environments=void 0;const r={maxWorkerCount:10,minimumStake:1e18.toString(),minimumUnstakeDelay:1e3,minimumEntryDepositValue:1e18.toString()};t.environments={istanbul:{chainId:1,relayHubConfiguration:r,mintxgascost:21e3},constantinople:{chainId:1,relayHubConfiguration:r,mintxgascost:21e3},rsk:{chainId:33,relayHubConfiguration:r,mintxgascost:21e3}},t.defaultEnvironment=t.environments.rsk,t.getEnvironment=function(e){return e.startsWith("rsk")?t.environments.rsk:t.defaultEnvironment},t.isRsk=function(e){return 33===e.chainId}},319:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){if(t instanceof Map)return{dataType:"Map",value:Array.from(t.entries())};if(t instanceof Error){const e={};return Object.getOwnPropertyNames(t).filter((e=>!["request","response"].includes(e))).forEach((function(r){e[r]=t[r]})),e}return t}},675:function(e,t,r){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.transactionParamDataCost=t.boolString=t.isRegistrationValid=t.getLatestEventData=t.isSecondEventLater=t.randomInRange=t.sleep=t.isSameAddress=t.parseHexString=t.estimateMaxPossibleRelayCallWithLinearFit=t.calculateDeployTransactionMaxPossibleGas=t.getEip712Signature=t.getLocalEip712Signature=t.decodeRevertReason=t.address2topic=t.addresses2topics=t.event2topic=t.padTo64=t.removeHexPrefix=void 0;const n=a(r(107)),s=r(784),i=a(r(458)),o=r(103),l=r(820),c=a(r(242)),u=r(738),d=r(414);function y(e){return"0x"+"0".repeat(24)+e.toLowerCase().slice(2)}function h(e,t){return e.toLowerCase()===t.toLowerCase()}t.removeHexPrefix=function(e){if(null==e||"function"!=typeof e.replace)throw new Error("Cannot remove hex prefix");return e.replace(/^0x/,"")},t.padTo64=function(e){return e.length<64&&(e=("0000000000000000000000000000000000000000000000000000000000000000"+e).slice(-64)),e},t.event2topic=function e(t,r){return t.options&&t.options.jsonInterface?"string"==typeof r?e(t,[r])[0]:t.options.jsonInterface.filter((e=>r.includes(e.name))).map(n.default.encodeEventSignature):r},t.addresses2topics=function(e){return e.map(y)},t.address2topic=y,t.decodeRevertReason=function(e,t=!1){if(null==e)return null;if(!e.startsWith("0x08c379a0")){if(t)throw new Error("invalid revert bytes: "+e);return e}return n.default.decodeParameter("string","0x"+e.slice(10))},t.getLocalEip712Signature=function(e,t){return i.default.signTypedData_v4(t,{data:e})},t.getEip712Signature=async function(e,t,r="",a=!1){const n=t.message.from;let s;return s=a?JSON.stringify(t):t,await new Promise(((t,a)=>{let i;i="function"==typeof e.currentProvider.sendAsync?e.currentProvider.sendAsync:e.currentProvider.send,i.bind(e.currentProvider)({method:"eth_signTypedData"+r,params:[n,s],from:n,id:Date.now()},((e,r)=>{var n;null!=(null==r?void 0:r.error)&&(e=r.error),null!=e||null==r?a(null!==(n=e.message)&&void 0!==n?n:e):t(r.result)}))}))},t.calculateDeployTransactionMaxPossibleGas=function(e,t){return void 0===t||null==t||s.toBN(t).isZero()?s.toBN(e).add(s.toBN("12000")):s.toBN(e)},t.estimateMaxPossibleRelayCallWithLinearFit=function(e,t,r=!1){const a=r?u.constants.ESTIMATED_GAS_CORRECTION_FACTOR:1;if(s.toBN(t).isZero()){const t=Number("85090.977"),r=Number("1.067")*e+t;return Math.ceil(r*a)}{const r=Number("72530.9611"),n=Number("1.1114")*(e+t)+r;return Math.ceil(n*a)}},t.parseHexString=function(e){const t=[];for(;e.length>=2;)t.push(parseInt(e.substring(0,2),16)),e=e.substring(2,e.length);return t},t.isSameAddress=h,t.sleep=async function(e){return await new Promise((t=>setTimeout(t,e)))},t.randomInRange=function(e,t){return Math.floor(Math.random()*(t-e)+e)},t.isSecondEventLater=function(e,t){return e.blockNumber===t.blockNumber?t.transactionIndex>e.transactionIndex:t.blockNumber>e.blockNumber},t.getLatestEventData=function(e){if(0!==e.length)return e.sort(((e,t)=>e.blockNumber===t.blockNumber?t.transactionIndex-e.transactionIndex:t.blockNumber-e.blockNumber))[0]},t.isRegistrationValid=function(e,t,r){const a=t.url.indexOf(":")>0;return null!=e&&h(e.returnValues.relayManager,r)&&e.returnValues.relayUrl.toString()===t.url.toString()+(!a&&t.port>0?":"+t.port.toString():"")},t.boolString=function(e){return e?c.default.green("good".padEnd(14)):c.default.red("wrong".padEnd(14))},t.transactionParamDataCost=function(e){var t;const r=d({contractName:"IRelayHub",abi:l.IRelayHub.abi});r.setProvider(web3.currentProvider,void 0);const a=new r(""),n=function(e){let t=!1;return void 0!==e.relayRequest.request.recoverer&&(t=!0),t}(e),s=null!==(t=(n?a.contract.methods.deployCall(e.relayRequest,e.metadata.signature):a.contract.methods.relayCall(e.relayRequest,e.metadata.signature)).encodeABI())&&void 0!==t?t:"0x",i=o.arrayify(s),c=function(e){let t=0;for(let r=0;r<e.length;r++)0!==e[r]&&++t;return t}(i),y=i.length-c;return u.constants.TRANSACTION_GAS_COST+y*u.constants.TX_ZERO_DATA_GAS_COST+c*u.constants.TX_NO_ZERO_DATA_GAS_COST}},415:function(e,t,r){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.VersionRegistry=t.bytes32toString=t.string32=void 0;const n=r(519),s=r(820),i=a(r(409));function o(e){return n.bufferToHex(Buffer.from(e)).padEnd(66,"0")}function l(e){return Buffer.from(e.replace(/^(?:0x)?(.*?)(00)*$/,"$1"),"hex").toString()}t.string32=o,t.bytes32toString=l,t.VersionRegistry=class{constructor(e,t,r={}){this.sendOptions=r,this.web3=new i.default(e),this.registryContract=new this.web3.eth.Contract(s.IVersionRegistry.abi,t)}async isValid(){const e=await this.web3.eth.getCode(this.registryContract.options.address);return"0x"!==e&&"0x00"!==e}async getVersion(e,t,r=""){const[a,n]=await Promise.all([this.getAllVersions(e),this.web3.eth.getBlock("latest").then((e=>e.timestamp))]),s=a.find((e=>!e.canceled&&(e.time+t<=n||e.version===r)));if(null==s)throw new Error(`getVersion(${e}) - no version found`);return s}async getAllVersions(e){const t=await this.registryContract.getPastEvents("allEvents",{fromBlock:1,topics:[null,o(e)]}),r=t.filter((e=>"VersionCanceled"===e.event)).reduce(((e,t)=>Object.assign(Object.assign({},e),{[t.returnValues.version]:t.returnValues.reason})),{}),a=new Set;return t.filter((e=>"VersionAdded"===e.event)).map((e=>({version:l(e.returnValues.version),canceled:null!=r[e.returnValues.version],cancelReason:r[e.returnValues.version],value:e.returnValues.value,time:parseInt(e.returnValues.time)}))).filter((e=>!a.has(e.version)&&(a.add(e.version),!0))).reverse()}async listIds(){const e=await this.registryContract.getPastEvents("VersionAdded",{fromBlock:1}),t=new Set(e.map((e=>l(e.returnValues.id))));return Array.from(t)}async addVersion(e,t,r,a={}){await this.checkVersion(e,t,!1),await this.registryContract.methods.addVersion(o(e),o(t),r).send(Object.assign(Object.assign({},this.sendOptions),a))}async cancelVersion(e,t,r="",a={}){await this.checkVersion(e,t,!0),await this.registryContract.methods.cancelVersion(o(e),o(t),r).send(Object.assign(Object.assign({},this.sendOptions),a))}async checkVersion(e,t,r){if(null!=(await this.getAllVersions(e).catch((()=>[]))).find((e=>e.version===t))!==r)throw new Error(`version ${r?"does not exist":"already exists"}: ${e} @ ${t}`)}}},223:function(e,t,r){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(r(513));t.default=class{constructor(e){if(null==n.default.valid(e))throw new Error("Component version is not valid");this.componentVersion=e}isMinorSameOrNewer(e){e=e.replace("_","-");const t="^"+this.componentVersion;return n.default.satisfies(e,t)}}},209:function(e,t,r){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.NetworkSimulatingProvider=void 0;const n=a(r(784)),s=r(360);class i extends s.WrapperProviderBase{constructor(e){super(e),this.isDelayTransactionsOn=!1,this.mempool=new Map}setDelayTransactions(e){this.isDelayTransactionsOn=e}calculateTxHash(e){const t=n.default.sha3(e.params[0]);if(null==t)throw new Error("Failed to hash transaction");return t}send(e,t){let r;if("eth_sendRawTransaction"===e.method&&this.isDelayTransactionsOn){const t=this.calculateTxHash(e);r={jsonrpc:"2.0",id:(a=e.id,"string"==typeof a?parseInt(a):"number"==typeof a?a:0),result:t},this.mempool.set(t,e)}var a;null!=r?t(null,r):this.provider.send(e,t)}supportsSubscriptions(){return!1}async mineTransaction(e){const t=this.mempool.get(e);return this.mempool.delete(e),await new Promise(((e,r)=>{if(null==t)throw new Error("Transaction is not in simulated mempool. It must be already mined");this.provider.send(t,(function(t,a){null!=t||null==a?r(t):e(a)}))}))}}t.NetworkSimulatingProvider=i},498:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ProfilingProvider=void 0;const a=r(360);class n extends a.WrapperProviderBase{constructor(e,t=!1){super(e),this.methodsCount=new Map,this.requestsCount=0,this.logTraffic=t}disconnect(){return!1}supportsSubscriptions(){return!1}send(e,t){var r,a;this.requestsCount++;const n=null!==(r=this.methodsCount.get(e.method))&&void 0!==r?r:0;this.methodsCount.set(e.method,n+1);let s=t;this.logTraffic&&(s=function(e,r){var a,n;null!=e&&console.log(`<<< error: ${null!==(a=e.message)&&void 0!==a?a:"null error message"}`),console.log(`<<< result: ${null!==(n=JSON.stringify(r))&&void 0!==n?n:"null result"}`),t(e,r)},console.log(`>>> payload: ${null!==(a=JSON.stringify(e))&&void 0!==a?a:"null result"}`)),this.provider.send(e,s)}reset(){this.requestsCount=0,this.methodsCount.clear()}log(){console.log("Profiling Provider Stats:"),new Map([...this.methodsCount.entries()].sort((function([,e],[,t]){return t-e}))).forEach((function(e,t){console.log(`Method: ${t.padEnd(30)} was called: ${e.toString().padEnd(3)} times`)})),console.log(`Total RPC calls: ${this.requestsCount}`)}}t.ProfilingProvider=n},792:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},360:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.WrapperProviderBase=void 0,t.WrapperProviderBase=class{constructor(e){this.provider=e}get connected(){return this.provider.connected}get host(){return this.provider.host}disconnect(){return this.provider.disconnect()}supportsSubscriptions(){return this.provider.supportsSubscriptions()}}},607:function(e,t,r){var a=this&&this.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r),Object.defineProperty(e,a,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,a){void 0===a&&(a=r),e[a]=t[r]}),n=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||a(t,e,r)},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.VersionsManager=t.replaceErrors=t.ContractInteractor=t.TypedRequestData=void 0;const i=s(r(172));t.TypedRequestData=i.default;const o=s(r(359));t.ContractInteractor=o.default;const l=s(r(319));t.replaceErrors=l.default;const c=s(r(223));t.VersionsManager=c.default,n(r(209),t),n(r(498),t),n(r(792),t),n(r(360),t),n(r(874),t),n(r(422),t),n(r(172),t),n(r(868),t),n(r(104),t),n(r(659),t),n(r(322),t),n(r(945),t),n(r(738),t),n(r(359),t),n(r(917),t),n(r(675),t),n(r(415),t)},868:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},104:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},659:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},322:function(e,t,r){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.RelayTransactionRequestShape=t.DeployTransactionRequestShape=void 0;const n=a(r(349));t.DeployTransactionRequestShape={relayRequest:{request:{relayHub:n.default.string,from:n.default.string,to:n.default.string,value:n.default.string,nonce:n.default.string,data:n.default.string,tokenContract:n.default.string,tokenAmount:n.default.string,tokenGas:n.default.string,recoverer:n.default.string,index:n.default.string},relayData:{gasPrice:n.default.string,domainSeparator:n.default.string,relayWorker:n.default.string,callForwarder:n.default.string,callVerifier:n.default.string}},metadata:{relayHubAddress:n.default.string,relayMaxNonce:n.default.number,signature:n.default.string}},t.RelayTransactionRequestShape={relayRequest:{request:{relayHub:n.default.string,from:n.default.string,to:n.default.string,value:n.default.string,gas:n.default.string,nonce:n.default.string,data:n.default.string,tokenContract:n.default.string,tokenAmount:n.default.string,tokenGas:n.default.string},relayData:{gasPrice:n.default.string,domainSeparator:n.default.string,relayWorker:n.default.string,callForwarder:n.default.string,callVerifier:n.default.string}},metadata:{relayHubAddress:n.default.string,relayMaxNonce:n.default.number,signature:n.default.string}}},103:e=>{e.exports=require("@ethersproject/bytes")},820:e=>{e.exports=require("@rsksmart/rif-relay-contracts")},414:e=>{e.exports=require("@truffle/contract")},416:e=>{e.exports=require("bn.js")},242:e=>{e.exports=require("chalk")},458:e=>{e.exports=require("eth-sig-util")},477:e=>{e.exports=require("ethereumjs-common")},519:e=>{e.exports=require("ethereumjs-util")},742:e=>{e.exports=require("ethval")},732:e=>{e.exports=require("loglevel")},349:e=>{e.exports=require("ow")},513:e=>{e.exports=require("semver")},748:e=>{e.exports=require("source-map-support")},409:e=>{e.exports=require("web3")},107:e=>{e.exports=require("web3-eth-abi")},784:e=>{e.exports=require("web3-utils")}},t={},r=function r(a){var n=t[a];if(void 0!==n)return n.exports;var s=t[a]={exports:{}};return e[a].call(s.exports,s,s.exports,r),s.exports}(607);module.exports=r})();